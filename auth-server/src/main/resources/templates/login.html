<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统登录</title>
    <link rel="stylesheet" th:href="@{/css/login.css}">
    <link rel="stylesheet" th:href="@{/css/transparent.css}">
    <script th:src="@{/js/api.js}"></script>
    <script th:src="@{/js/SDKBridge.js}"></script>
    <style>
        html,
        body {
            background-color: transparent !important;
            background: transparent !important;
        }

        .login-container {
            background-color: transparent !important;
            background: transparent !important;
        }
    </style>
</head>

<body>
<div class="login-container">
    <div class="login-box">
        <h2>用户登录</h2>
        <div id="loginForm">
            <div class="input-group">
                <label for="username">账号</label>
                <input type="text" id="username" name="username" required autocomplete="off">
            </div>
            <div class="input-group">
                <label for="password">密码</label>
                <input type="password" id="password" name="password" required>
            </div>
            <div id="errorMessage" class="error-message" style="display: none;">
                <p>账号或密码错误，请重试</p>
            </div>
            <div class="input-group">
                <button type="button" id="loginButton">登录</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const loginButton = document.getElementById('loginButton');
        const username = document.getElementById('username');
        const password = document.getElementById('password');
        const errorMessage = document.getElementById('errorMessage');

        // 确保背景透明
        document.body.style.backgroundColor = 'transparent';
        document.documentElement.style.backgroundColor = 'transparent';

        // 监听登录按钮点击事件
        loginButton.addEventListener('click', function () {
            login();
        });

        // 监听回车键触发登录
        document.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                login();
            }
        });

        // 登录函数
        function login() {
            // 基本验证
            if (!username.value || !password.value) {
                errorMessage.style.display = 'block';
                errorMessage.querySelector('p').textContent = '请输入账号和密码';
                return;
            }

            // 发送HTTP请求
            API.login(username.value, password.value)
                .then(data => {
                    if (data.code === 0) {
                        // 登录成功，调用SDK的登录成功方法
                        window.loginSuccess({
                            userId: data.data.userId.toString(),
                            accessToken: data.data.accessToken,
                            nickname: data.data.nickname,
                            uuid: data.data.uuid,
                            phone: data.data.phone,
                            age: data.data.age.toString(),
                            loginType: 1,
                            isRegGame: data.data.isRegGame,
                            isAuthentication: data.data.isAuthentication
                        });
                    } else {
                        // 登录失败
                        errorMessage.style.display = 'block';
                        errorMessage.querySelector('p').textContent = data.msg || '账号或密码错误，请重试';
                    }
                })
                .catch(error => {
                    console.error('登录出错:', error);
                    errorMessage.style.display = 'block';
                    errorMessage.querySelector('p').textContent = '登录请求出错，请稍后再试';
                });
        }

        // 初始化SDKBridge
        if (window.getHeader) {
            window.getHeader(function (code, data) {
                if (code === 0 && data) {
                    console.log('获取到SDK头部信息:', data);
                }
            });
        }
    });
</script>
</body>

</html>